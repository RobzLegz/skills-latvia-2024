(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94],{3740:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/playlist/[id]",function(){return r(3289)}])},9325:function(e,t,r){"use strict";r.d(t,{_:function(){return l}});let s=new(r(385)).PrismaClient;var n=r(9704),a=r.n(n),i=r(3454);let u=async(e,t)=>{try{let{refresh_token:r}=e.cookies;if(!r)return t.status(400).json({err:"Unauthorized"}),null;let n=a().verify(r,String(i.env.REFRESH_TOKEN_SECRET));if(!n)return t.status(400).json({err:"Unauthorized"}),null;let u=await s.user.findFirst({where:{id:Number(n)}});if(!u)return t.status(400).json({err:"Unauthorized"}),null;return u}catch(e){console.log(e)}},l={create:async(e,t)=>{try{let r=await u(e,t);if(!r)return;let{title:n,description:a}=e.body;if(!n)return t.status(400).json({err:"No title provided"});let i=await s.playlist.create({data:{title:n,description:a,userId:r.id}});t.json(i)}catch(e){return console.log(e.message),t.status(500).json({err:"Radās kļūme"})}},edit:async(e,t)=>{try{let r=await u(e,t);if(!r)return;let{id:n}=e.query,{title:a,description:i}=e.body;if(!a)return t.status(400).json({err:"No title provided"});let l=await s.playlist.update({where:{id:Number(n)},data:{title:a,description:i,userId:r.id}});t.json(l)}catch(e){return console.log(e.message),t.status(500).json({err:"Radās kļūme"})}},deleteOne:async(e,t)=>{try{if(!await u(e,t))return;let{id:r}=e.query;await s.songInPlaylist.deleteMany({where:{playlistId:Number(r)}}),await s.playlist.delete({where:{id:Number(r)}}),t.json({msg:"Deleted"})}catch(e){return console.log(e.message),t.status(500).json({err:"Radās kļūme"})}},getOne:async(e,t)=>{try{if(!await u(e,t))return;let{id:r}=e.query,n=await s.playlist.findFirst({where:{id:Number(r)},include:{songs:{select:{song:!0}}}});t.json(n)}catch(e){return console.log(e.message),t.status(500).json({err:"Radās kļūme"})}}}},3289:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var s=r(9325);function n(e,t){switch(e.method){case"PUT":s._.edit(e,t);case"DELETE":s._.edit(e,t)}}}},function(e){e.O(0,[714,876,239,888,774,179],function(){return e(e.s=3740)}),_N_E=e.O()}]);