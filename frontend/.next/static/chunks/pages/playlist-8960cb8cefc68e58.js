(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[580],{7665:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/playlist",function(){return r(2156)}])},9325:function(e,t,r){"use strict";r.d(t,{_:function(){return l}});let n=new(r(385)).PrismaClient;var s=r(9704),a=r.n(s),i=r(3454);let u=async(e,t)=>{try{let{refresh_token:r}=e.cookies;if(!r)return t.status(400).json({err:"Unauthorized"}),null;let s=a().verify(r,String(i.env.REFRESH_TOKEN_SECRET));if(!s)return t.status(400).json({err:"Unauthorized"}),null;let u=await n.user.findFirst({where:{id:Number(s)}});if(!u)return t.status(400).json({err:"Unauthorized"}),null;return u}catch(e){console.log(e)}},l={create:async(e,t)=>{try{let r=await u(e,t);if(!r)return;let{title:s,description:a}=e.body;if(!s)return t.status(400).json({err:"No title provided"});let i=await n.playlist.create({data:{title:s,description:a,userId:r.id}});t.json(i)}catch(e){return console.log(e.message),t.status(500).json({err:"Radās kļūme"})}},edit:async(e,t)=>{try{let r=await u(e,t);if(!r)return;let{id:s}=e.query,{title:a,description:i}=e.body;if(!a)return t.status(400).json({err:"No title provided"});let l=await n.playlist.update({where:{id:Number(s)},data:{title:a,description:i,userId:r.id}});t.json(l)}catch(e){return console.log(e.message),t.status(500).json({err:"Radās kļūme"})}},deleteOne:async(e,t)=>{try{if(!await u(e,t))return;let{id:r}=e.query;await n.songInPlaylist.deleteMany({where:{playlistId:Number(r)}}),await n.playlist.delete({where:{id:Number(r)}}),t.json({msg:"Deleted"})}catch(e){return console.log(e.message),t.status(500).json({err:"Radās kļūme"})}},getOne:async(e,t)=>{try{if(!await u(e,t))return;let{id:r}=e.query,s=await n.playlist.findFirst({where:{id:Number(r)},include:{songs:{select:{song:!0}}}});t.json(s)}catch(e){return console.log(e.message),t.status(500).json({err:"Radās kļūme"})}}}},2156:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(9325);function s(e,t){"POST"===e.method&&n._.create(e,t)}}},function(e){e.O(0,[714,876,239,888,774,179],function(){return e(e.s=7665)}),_N_E=e.O()}]);